webpackJsonp([14],{694:function(t,e,i){i(821);var s=i(1)(i(771),i(847),"data-v-117d6d64",null);t.exports=s.exports},716:function(t,e,i){"use strict";function s(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,i,n){e=e||"&",i=i||"=";var r={};if("string"!=typeof t||0===t.length)return r;var o=/\+/g;t=t.split(e);var l=1e3;n&&"number"==typeof n.maxKeys&&(l=n.maxKeys);var c=t.length;l>0&&c>l&&(c=l);for(var u=0;u<c;++u){var d,p,f,h,v=t[u].replace(o,"%20"),m=v.indexOf(i);m>=0?(d=v.substr(0,m),p=v.substr(m+1)):(d=v,p=""),f=decodeURIComponent(d),h=decodeURIComponent(p),s(r,f)?a(r[f])?r[f].push(h):r[f]=[r[f],h]:r[f]=h}return r};var a=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},717:function(t,e,i){"use strict";function s(t,e){if(t.map)return t.map(e);for(var i=[],s=0;s<t.length;s++)i.push(e(t[s],s));return i}var a=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,i,o){return e=e||"&",i=i||"=",null===t&&(t=void 0),"object"==typeof t?s(r(t),function(r){var o=encodeURIComponent(a(r))+i;return n(t[r])?s(t[r],function(t){return o+encodeURIComponent(a(t))}).join(e):o+encodeURIComponent(a(t[r]))}).join(e):o?encodeURIComponent(a(o))+i+encodeURIComponent(a(t)):""};var n=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},r=Object.keys||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return e}},718:function(t,e,i){"use strict";e.decode=e.parse=i(716),e.encode=e.stringify=i(717)},771:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(718);e.default={data:function(){return{csrf:"",policies:[],policyRules:"",policyRulesModified:"",loading:!1,nameFilter:"",search:{str:"",found:[],searched:0,regex:!1},selectedPolicy:""}},mounted:function(){var t=this;this.$http.get("/api/policy").then(function(e){t.policies=e.data.result,t.csrf=e.headers["x-csrf-token"]}).catch(function(e){t.$onError(e)})},computed:{filteredPolicies:function(){if(this.nameFilter){var t=this.nameFilter;return this.policies.filter(function(e){return e.includes(t)})}return this.search.searched?this.search.found:this.policies}},methods:{getPolicyRules:function(t){var e=this;this.policyRules="",this.policyRulesModified="",this.selectedPolicy=t,this.$http.get("/api/policy?policy="+t).then(function(t){e.policyRules=t.data.result,e.policyRulesModified=e.policyRules}).catch(function(t){e.$onError(t)})},filterByDetails:function(){var t=this;if(""!==this.search.str){this.search.found=[],this.search.searched=0,this.loading=this.policies.length;for(var e=0;e<this.policies.length;e++)!function(){var i=t.policies[e];t.$http.get("/api/policy?policy="+i).then(function(e){var s=t.search.regex?t.search.str:t.makeRegex(t.search.str);e.data.result.match(s)&&t.search.found.push(i),t.search.searched++,t.loading=t.loading-1||!1}).catch(function(e){t.$onError(e),t.search.searched++,t.loading=t.loading-1||!1})}()}},addPolicyRequest:function(){var t=this;this.$http.post("/api/policy/request?policy="+this.selectedPolicy,s.stringify({rules:this.policyRulesModified}),{headers:{"X-CSRF-Token":this.csrf}}).then(function(e){t.$message({message:"Your change ID is: "+e.data.result,type:"success",duration:0,showCloseButton:!0}),""!==e.data.error&&t.$notify({title:"Slack webhook",message:e.data.error,type:"warning"})}).catch(function(e){t.$onError(e)})},makeRegex:function(t){var e=t.lastIndexOf("/");if(-1===e)for(var i=t,s='"('+t,a=t.length+1;a>0;a--)s+="|"+i+"\\*",i=i.substring(0,a-2);else{if(""===(i=t.substring(e+1,t.length))){var n=t.replace("/","\\/");return'"('+n+"|"+n+'\\*)"'}for(s='"'+t.substring(0,e),s=s.replace("/","\\/")+"\\/("+i,a=i.length+1;a>0;a--)s+="|"+i+"\\*",i=i.substring(0,a-2)}return s+')"'}}}},796:function(t,e,i){e=t.exports=i(676)(),e.push([t.i,".button[data-v-117d6d64]{margin:5px 0 0}.control .button[data-v-117d6d64]{margin:inherit}.fa-trash-o[data-v-117d6d64]{color:red}.fa-info[data-v-117d6d64]{color:#87cefa}.textarea[data-v-117d6d64]{height:500px}","",{version:3,sources:["/data/serverless-cms-admin/client/views/admin/Policies.vue"],names:[],mappings:"AACA,yBACE,cAAgB,CACjB,AACD,kCACE,cAAgB,CACjB,AACD,6BACE,SAAW,CACZ,AACD,0BACE,aAAoB,CACrB,AACD,2BACE,YAAc,CACf",file:"Policies.vue",sourcesContent:["\n.button[data-v-117d6d64] {\n  margin: 5px 0 0;\n}\n.control .button[data-v-117d6d64] {\n  margin: inherit;\n}\n.fa-trash-o[data-v-117d6d64] {\n  color: red;\n}\n.fa-info[data-v-117d6d64] {\n  color: lightskyblue;\n}\n.textarea[data-v-117d6d64] {\n  height: 500px;\n}\n"],sourceRoot:""}])},821:function(t,e,i){var s=i(796);"string"==typeof s&&(s=[[t.i,s,""]]);i(677)(s,{});s.locals&&(t.exports=s.locals)},847:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"tile is-ancestor is-vertical"},[i("div",{staticClass:"tile is-parent"},[i("article",{staticClass:"tile is-child box"},[i("nav",{staticClass:"level"},[i("div",{staticClass:"level-left"},[i("div",{staticClass:"level-item"},[i("p",{staticClass:"control has-icons-left"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.nameFilter,expression:"nameFilter"}],staticClass:"input",attrs:{type:"text",placeholder:"Filter by policy name"},domProps:{value:t.nameFilter},on:{input:function(e){e.target.composing||(t.nameFilter=e.target.value)}}}),t._v(" "),t._m(0)])])]),t._v(" "),i("div",{staticClass:"level-item"},[i("p",{staticClass:"subtitle is-5"},[t._v("\n              Displaying "),i("strong",[t._v(" "+t._s(t.filteredPolicies.length)+" ")]),t._v(" out of "),i("strong",[t._v(t._s(t.policies.length))]),t._v(" policies\n            ")])]),t._v(" "),i("div",{staticClass:"level-right"},[i("div",{staticClass:"level-item"},[i("div",{staticClass:"field has-addons"},[i("p",{staticClass:"control has-icons-right"},[i("span",{staticClass:"select"},[i("select",{directives:[{name:"model",rawName:"v-model",value:t.search.regex,expression:"search.regex"}],on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.search.regex=e.target.multiple?i:i[0]}}},[i("option",{domProps:{value:!1}},[t._v("Smart Search")]),t._v(" "),i("option",{domProps:{value:!0}},[t._v("Regex")])])])]),t._v(" "),i("p",{staticClass:"control"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.search.str,expression:"search.str"}],staticClass:"input",attrs:{type:"text",placeholder:t.search.regex?"Filter by policy details":"foo/bar matches foo/*"},domProps:{value:t.search.str},on:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13))return null;t.filterByDetails()},input:function(e){e.target.composing||(t.search.str=e.target.value)}}})]),t._v(" "),i("p",{staticClass:"control"},[i("button",{staticClass:"button is-info",class:t.loading?"is-loading":"",on:{click:function(e){t.filterByDetails()}}},[t._v("\n                    Search\n                  ")])])])])])])])]),t._v(" "),i("div",{staticClass:"tile is-parent is-marginless is-paddingless"},[i("div",{staticClass:"tile is-parent is-child is-vertical is-5"},[i("article",{staticClass:"tile is-child box"},[i("div",{staticClass:"table-responsive"},[i("table",{staticClass:"table is-striped is-narrow"},[t._m(1),t._v(" "),i("tbody",t._l(t.filteredPolicies,function(e,s){return i("tr",[i("td",{attrs:{width:"34"}},[i("span",{staticClass:"icon"},[i("a",{on:{click:function(i){t.getPolicyRules(e)}}},[i("i",{staticClass:"fa fa-info"})])])]),t._v(" "),i("td",[t._v("\n                    "+t._s(e)+"\n                  ")])])}))])])])]),t._v(" "),i("div",{staticClass:"tile is-parent is-vertical"},[i("article",{staticClass:"tile is-child box"},[i("h4",{staticClass:"title is-4"},[t._v("Policy Rules")]),t._v(" "),i("div",{staticClass:"field"},[i("p",{staticClass:"control"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.policyRulesModified,expression:"policyRulesModified"}],staticClass:"textarea",attrs:{placeholder:"Select a policy"},domProps:{value:t.policyRulesModified},on:{input:function(e){e.target.composing||(t.policyRulesModified=e.target.value)}}})])]),t._v(" "),i("div",{staticClass:"field"},[i("p",{staticClass:"control is-pulled-right"},[i("a",{staticClass:"button is-primary is-outlined",attrs:{disabled:t.policyRules===t.policyRulesModified},on:{click:function(e){t.addPolicyRequest()}}},[i("span",[t._v("Request changes")]),t._v(" "),t._m(2)])])])])])])])])},staticRenderFns:[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("span",{staticClass:"icon is-small is-left"},[i("i",{staticClass:"fa fa-search"})])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("thead",[i("tr",[i("th"),t._v(" "),i("th",[t._v("Policy Name")])])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("span",{staticClass:"icon is-small"},[i("i",{staticClass:"fa fa-check"})])}]}}});